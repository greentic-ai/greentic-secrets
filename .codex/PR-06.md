PR-06.md — CI hardening, matrix, required checks, and “one command” local runner
Title

greentic-secrets: unify CI provider jobs + add local “run all integration tests” script

Goal

Make it easy to run everything:

In CI: clear status checks (PR vs nightly)

Locally: one script that spins up kind + vault + localstack and runs relevant tests

Repo changes
A) Workflow improvements

Add concurrency to avoid overlap per branch

Add caching (actions/cache) for cargo registry/target

Add fail-fast: false for matrix so one provider failure doesn’t hide others

Split jobs:

PR: k8s_kind, vault_dev, aws_localstack

Nightly/manual: aws_real, azure_real, gcp_real (+ optionally rerun PR jobs)

B) Required checks config (documented)

Add docs/ci/required-checks.md listing what should be required for PR merge:

unit + lint

k8s_kind

vault_dev

aws_localstack

C) Local runner script

Add scripts/run_provider_integration.sh (or .ps1 too if you want):

starts:

kind cluster

vault dev container

localstack container

exports env vars

runs:

cargo test -p secrets-provider-k8s --features integration -- --ignored

cargo test -p secrets-provider-vault --features integration -- --ignored

cargo test -p secrets-provider-aws-sm --features integration -- --ignored

teardown on exit unless KEEP=1

D) Diagnostics on failure

In workflow, on failure:

print kubectl get all -A

print vault logs

print localstack logs

Acceptance criteria

CI is faster and clearer

Local script works on Linux/macOS (Docker required)
